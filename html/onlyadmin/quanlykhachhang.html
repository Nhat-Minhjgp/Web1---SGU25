<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω t√†i kho·∫£n</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen p-6">
    <h1 class="text-3xl font-bold text-cyan-400 mb-6">üîê Qu·∫£n l√Ω t√†i kho·∫£n</h1>

    <button
      onclick="goBack()"
      class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded mb-4"
    >
      ‚Üê Quay l·∫°i
    </button>

    <input
      type="text"
      id="searchInput"
      placeholder="üîç T√¨m theo t√™n..."
      class="bg-gray-700 text-white px-3 py-2 rounded w-full mb-4"
    />

    <table
      class="w-full table-auto bg-gray-800 rounded-lg overflow-hidden shadow-lg"
    >
      <thead class="bg-gray-700 text-cyan-300">
        <tr>
          <th class="px-4 py-2 text-left">H·ªç t√™n</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-left">SƒêT</th>
          <th class="px-4 py-2 text-left">T√™n ƒëƒÉng nh·∫≠p</th>
          <th class="px-4 py-2 text-left">Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="accountTable" class="text-gray-200"></tbody>
    </table>

    <!-- Modal s·ª≠a -->
    <div
      id="editModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
        <h2 class="text-xl font-bold text-cyan-400 mb-4">üìù S·ª≠a t√†i kho·∫£n</h2>
        <form id="editForm" class="space-y-4">
          <input
            type="text"
            id="editName"
            class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="H·ªç t√™n"
            required
          />
          <input
            type="email"
            id="editEmail"
            class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="Email"
            required
          />
          <input
            type="text"
            id="editPhone"
            class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="SƒêT"
            required
          />
          <input
            type="text"
            id="editUsername"
            class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="T√™n ƒëƒÉng nh·∫≠p"
            required
          />
          <input
            type="text"
            id="editAddress"
            class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="ƒê·ªãa ch·ªâ"
          />
          <div class="border-t border-gray-700 pt-4">
            <h3 class="text-lg font-semibold text-cyan-300 mb-2">ƒê·ªïi m·∫≠t kh·∫©u</h3>
            <input
              type="password"
              id="editPassword"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full mb-2"
              placeholder="M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)"
            />
            <input
              type="password"
              id="editConfirmPassword"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi"
            />
          </div>
          <div class="flex justify-end space-x-2">
            <button
              type="button"
              onclick="closeModal()"
              class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500"
            >
              H·ªßy
            </button>
            <button
              type="submit"
              class="bg-cyan-500 text-gray-900 font-semibold px-4 py-2 rounded hover:bg-cyan-600"
            >
              L∆∞u
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      function goBack() {
        window.location.href = "daodienad.html";
      }

      let users = JSON.parse(localStorage.getItem("users")) || [];
      let editIndex = null;

      function renderUsers(filter = "") {
        const table = document.getElementById("accountTable");
        table.innerHTML = "";

        const filteredUsers = users.filter(
          (u) =>
            u.fullName &&
            u.fullName.toLowerCase().includes(filter.toLowerCase())
        );

        if (filteredUsers.length === 0) {
          table.innerHTML = `
            <tr>
              <td colspan="5" class="px-4 py-4 text-center text-gray-400">
                Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n n√†o
              </td>
            </tr>
          `;
          return;
        }

        filteredUsers.forEach((u, i) => {
          // T√¨m index th·ª±c t·∫ø trong m·∫£ng users g·ªëc
          const originalIndex = users.findIndex(user => user.email === u.email);
          
          const row = document.createElement("tr");
          row.className = "border-b border-gray-700";
          row.innerHTML = `
            <td class="px-4 py-2">${u.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-2">${u.email || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-2">${u.phone || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-2">${u.username || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-2 space-x-2">
              <button onclick="editUser(${originalIndex})" class="bg-yellow-500 text-gray-900 px-3 py-1 rounded hover:bg-yellow-600 text-sm">S·ª≠a</button>
              <button onclick="deleteUser(${originalIndex})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">X√≥a</button>
            </td>
          `;
          table.appendChild(row);
        });
      }

      function saveUsers() {
        localStorage.setItem("users", JSON.stringify(users));
        renderUsers(document.getElementById("searchInput").value);
      }

      function deleteUser(index) {
        if (index < 0 || index >= users.length) {
          alert("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n ƒë·ªÉ x√≥a!");
          return;
        }

        const userToDelete = users[index];
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n "${userToDelete.fullName || userToDelete.email}"?`)) {
          users.splice(index, 1);
          saveUsers();
          alert("ƒê√£ x√≥a t√†i kho·∫£n th√†nh c√¥ng!");
        }
      }

      function editUser(index) {
        if (index < 0 || index >= users.length) {
          alert("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n ƒë·ªÉ ch·ªânh s·ª≠a!");
          return;
        }

        editIndex = index;
        const u = users[index];
        document.getElementById("editName").value = u.fullName || '';
        document.getElementById("editEmail").value = u.email || '';
        document.getElementById("editPhone").value = u.phone || '';
        document.getElementById("editUsername").value = u.username || '';
        document.getElementById("editAddress").value = u.address || '';
        document.getElementById("editPassword").value = '';
        document.getElementById("editConfirmPassword").value = '';
        document.getElementById("editModal").classList.remove("hidden");
      }

      function closeModal() {
        document.getElementById("editModal").classList.add("hidden");
      }

      document
        .getElementById("editForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          
          const newPassword = document.getElementById("editPassword").value.trim();
          const confirmPassword = document.getElementById("editConfirmPassword").value.trim();
          
          // Ki·ªÉm tra m·∫≠t kh·∫©u n·∫øu c√≥ nh·∫≠p
          if (newPassword && newPassword !== confirmPassword) {
            alert("M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp!");
            return;
          }
          
          // C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng
          users[editIndex].fullName = document
            .getElementById("editName")
            .value.trim();
          users[editIndex].email = document
            .getElementById("editEmail")
            .value.trim();
          users[editIndex].phone = document
            .getElementById("editPhone")
            .value.trim();
          users[editIndex].username = document
            .getElementById("editUsername")
            .value.trim();
          users[editIndex].address = document
            .getElementById("editAddress")
            .value.trim();
          
          // C·∫≠p nh·∫≠t m·∫≠t kh·∫©u n·∫øu c√≥
          if (newPassword) {
            users[editIndex].password = newPassword;
          }
          
          saveUsers();
          closeModal();
          alert("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
        });

      document
        .getElementById("searchInput")
        .addEventListener("input", function () {
          renderUsers(this.value);
        });

      // Kh·ªüi t·∫°o trang
      renderUsers();
    </script>
  </body>
</html>