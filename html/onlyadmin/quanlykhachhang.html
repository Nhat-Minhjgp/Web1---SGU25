<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
</head>

<body class="bg-gray-900 text-white min-h-screen p-6">
  <header class="flex justify-between items-center px-6 py-4 bg-gray-800 shadow-md mb-6">
    <div class="flex items-center space-x-4">
      <button onclick="goBack()"
        class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-semibold px-4 py-2 rounded-lg transition flex items-center">
        <i class="fas fa-arrow-left mr-2"></i>Quay l·∫°i
      </button>
      <h1 class="text-2xl font-bold text-cyan-400">Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h1>
    </div>
    <div class="flex items-center space-x-2">
      <button onclick="logout()"
        class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-semibold px-4 py-2 rounded-full text-sm transition">
        ƒêƒÉng xu·∫•t
      </button>
    </div>
  </header>

  <!-- Th√¥ng b√°o -->
  <div id="notification" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 hidden"></div>

  <!-- Thanh c√¥ng c·ª• -->
  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <input type="text" id="searchInput" placeholder="üîç T√¨m theo t√™n ho·∫∑c email..."
      class="bg-gray-700 text-white px-3 py-2 rounded flex-1" />
    <div class="flex gap-2">
      <button onclick="openAddModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold">
        ‚ûï Th√™m t√†i kho·∫£n
      </button>
    </div>
  </div>

  <!-- Th·ªëng k√™ -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-gray-800 p-4 rounded-lg text-center">
      <div class="text-2xl font-bold text-cyan-400">${users.length}</div>
      <div class="text-sm text-gray-400">T·ªïng ng∆∞·ªùi d√πng</div>
    </div>
    <div class="bg-gray-800 p-4 rounded-lg text-center">
      <div class="text-2xl font-bold text-green-400">${users.filter(u => u.status === 'active').length}</div>
      <div class="text-sm text-gray-400">ƒêang ho·∫°t ƒë·ªông</div>
    </div>
    <div class="bg-gray-800 p-4 rounded-lg text-center">
      <div class="text-2xl font-bold text-red-400">${users.filter(u => u.status === 'locked').length}</div>
      <div class="text-sm text-gray-400">B·ªã kh√≥a</div>
    </div>
    <div class="bg-gray-800 p-4 rounded-lg text-center">
      <div class="text-2xl font-bold text-purple-400">${users.filter(u => u.isAdmin).length}</div>
      <div class="text-sm text-gray-400">Qu·∫£n tr·ªã vi√™n</div>
    </div>
  </div>

  <!-- B·∫£ng ng∆∞·ªùi d√πng -->
  <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
    <table class="w-full table-auto">
      <thead class="bg-gray-700 text-cyan-300">
        <tr>
          <th class="px-4 py-3 text-left">H·ªç t√™n</th>
          <th class="px-4 py-3 text-left">Email</th>
          <th class="px-4 py-3 text-left">T√™n ƒëƒÉng nh·∫≠p</th>
          <th class="px-4 py-3 text-left">SƒêT</th>
          <th class="px-4 py-3 text-left">Vai tr√≤</th>
          <th class="px-4 py-3 text-left">Tr·∫°ng th√°i</th>
          <th class="px-4 py-3 text-left">Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="accountTable" class="text-gray-200"></tbody>
    </table>
  </div>

  <!-- Modal th√™m t√†i kho·∫£n -->
  <div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-40">
    <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
      <h2 class="text-xl font-bold text-cyan-400 mb-4">‚ûï Th√™m t√†i kho·∫£n m·ªõi</h2>
      <form id="addForm" class="space-y-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">H·ªç t√™n *</label>
          <input type="text" id="addName" class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="Nh·∫≠p h·ªç t√™n" required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Email *</label>
          <input type="email" id="addEmail" class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="Nh·∫≠p email" required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">S·ªë ƒëi·ªán tho·∫°i *</label>
          <input type="text" id="addPhone" class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">T√™n ƒëƒÉng nh·∫≠p *</label>
          <input type="text" id="addUsername" class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">ƒê·ªãa ch·ªâ</label>
          <textarea id="addAddress" class="bg-gray-700 text-white px-3 py-2 rounded w-full resize-none"
            placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" rows="2"></textarea>
        </div>
        <div class="border-t border-gray-700 pt-4">
          <h3 class="text-lg font-semibold text-cyan-300 mb-2">M·∫≠t kh·∫©u</h3>
          <div class="flex items-center space-x-2 mb-2">
            <input type="text" id="addPassword" class="bg-gray-700 text-white px-3 py-2 rounded flex-1"
              placeholder="M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh" value="123456" readonly />
            <button type="button" onclick="generatePassword()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm">
              T·∫°o m·ªõi
            </button>
          </div>
          <p class="text-xs text-gray-400">
            M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh: <span class="font-mono">123456</span>
          </p>
        </div>
        <div class="flex justify-end space-x-2 pt-4">
          <button type="button" onclick="closeAddModal()" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500">
            H·ªßy
          </button>
          <button type="submit" class="bg-green-500 text-white font-semibold px-4 py-2 rounded hover:bg-green-600">
            T·∫°o t√†i kho·∫£n
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal s·ª≠a t√†i kho·∫£n -->
  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-40">
    <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
      <h2 class="text-xl font-bold text-cyan-400 mb-4">üìù S·ª≠a t√†i kho·∫£n</h2>
      <form id="editForm" class="space-y-4">
        <input type="hidden" id="editIndex">
        <div>
          <label class="block text-sm text-gray-300 mb-1">H·ªç t√™n *</label>
          <input type="text" id="editName" class="bg-gray-700 text-white px-3 py-2 rounded w-full" placeholder="H·ªç t√™n"
            required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Email *</label>
          <input type="email" id="editEmail" class="bg-gray-700 text-white px-3 py-2 rounded w-full" placeholder="Email"
            required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">S·ªë ƒëi·ªán tho·∫°i *</label>
          <input type="text" id="editPhone" class="bg-gray-700 text-white px-3 py-2 rounded w-full" placeholder="SƒêT"
            required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">T√™n ƒëƒÉng nh·∫≠p *</label>
          <input type="text" id="editUsername" class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="T√™n ƒëƒÉng nh·∫≠p" required />
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">ƒê·ªãa ch·ªâ</label>
          <textarea id="editAddress" class="bg-gray-700 text-white px-3 py-2 rounded w-full resize-none"
            placeholder="ƒê·ªãa ch·ªâ" rows="2"></textarea>
        </div>
        <div class="border-t border-gray-700 pt-4">
          <h3 class="text-lg font-semibold text-cyan-300 mb-2">ƒê·ªïi m·∫≠t kh·∫©u</h3>
          <div class="flex items-center space-x-2 mb-2">
            <input type="text" id="editPassword" class="bg-gray-700 text-white px-3 py-2 rounded flex-1"
              placeholder="M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)" />
            <button type="button" onclick="generateEditPassword()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm">
              T·∫°o m·ªõi
            </button>
          </div>
          <input type="text" id="editConfirmPassword" class="bg-gray-700 text-white px-3 py-2 rounded w-full"
            placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi" />
        </div>
        <div class="flex justify-end space-x-2 pt-4">
          <button type="button" onclick="closeEditModal()" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500">
            H·ªßy
          </button>
          <button type="submit" class="bg-cyan-500 text-gray-900 font-semibold px-4 py-2 rounded hover:bg-cyan-600">
            L∆∞u thay ƒë·ªïi
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // localStorage.removeItem("users");

    let users = JSON.parse(localStorage.getItem("users")) || [];

    // Kh√°ch h√†ng m·∫∑c ƒë·ªãnh
    const defaultCustomers = [
      {
        fullName: "Nguy·ªÖn VƒÉn An",
        email: "nguyenvanan@gmail.com",
        phone: "0901111111",
        username: "nguyenvanan",
        address: "123 Nguy·ªÖn VƒÉn C·ª´, Qu·∫≠n 1, TP.HCM",
        password: "123456",
        status: "active",
        createdAt: new Date().toISOString(),
        isAdmin: false
      },
      {
        fullName: "Tr·∫ßn Th·ªã B√¨nh",
        email: "tranthibinh@gmail.com",
        phone: "0902222222",
        username: "tranthibinh",
        address: "456 L√™ L·ª£i, Qu·∫≠n 3, TP.HCM",
        password: "123456",
        status: "active",
        createdAt: new Date().toISOString(),
        isAdmin: false
      },
      {
        fullName: "L√™ VƒÉn C∆∞·ªùng",
        email: "levancuong@gmail.com",
        phone: "0903333333",
        username: "levancuong",
        address: "789 Hai B√† Tr∆∞ng, Qu·∫≠n 1, TP.HCM",
        password: "123456",
        status: "active",
        createdAt: new Date().toISOString(),
        isAdmin: false
      },
      {
        fullName: "Ph·∫°m Th·ªã Dung",
        email: "phamthidung@gmail.com",
        phone: "0904444444",
        username: "phamthidung",
        address: "321 C√°ch M·∫°ng Th√°ng 8, Qu·∫≠n 10, TP.HCM",
        password: "123456",
        status: "active",
        createdAt: new Date().toISOString(),
        isAdmin: false
      },
      {
        fullName: "Ho√†ng VƒÉn Em",
        email: "hoanganem@gmail.com",
        phone: "0905555555",
        username: "hoanganem",
        address: "654 Nguy·ªÖn Tr√£i, Qu·∫≠n 5, TP.HCM",
        password: "123456",
        status: "active",
        createdAt: new Date().toISOString(),
        isAdmin: false
      }
    ];

    function goBack() {
      window.location.href = "daodienad.html";
    }

    function logout() {
      localStorage.removeItem("currentAdmin");
      window.location.href = "admin.html";
    }

    // H√†m t·ª± ƒë·ªông th√™m kh√°ch h√†ng m·∫∑c ƒë·ªãnh
    function autoAddDefaultCustomers() {
      let addedCount = 0;
      
      defaultCustomers.forEach(customer => {
        // Ki·ªÉm tra xem email ƒë√£ t·ªìn t·∫°i ch∆∞a
        const exists = users.some(u => u.email === customer.email);
        if (!exists) {
          users.push(customer);
          addedCount++;
        }
      });

      if (addedCount > 0) {
        console.log(`ƒê√£ t·ª± ƒë·ªông th√™m ${addedCount} kh√°ch h√†ng m·∫∑c ƒë·ªãnh v√†o h·ªá th·ªëng!`);
        saveUsers();
      }
    }

    // Kh·ªüi t·∫°o t√†i kho·∫£n admin v√† kh√°ch h√†ng m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥
    if (users.length === 0) {
      users = [
        {
          fullName: "Qu·∫£n tr·ªã vi√™n",
          email: "admin@mash.com",
          phone: "0900000000",
          username: "admin",
          address: "273 An D∆∞∆°ng V∆∞∆°ng, Ph∆∞·ªùng Ch·ª£ Qu√°n, H·ªì Ch√≠ Minh",
          password: "admin123",
          status: "active",
          createdAt: new Date().toISOString(),
          isAdmin: true
        },
        {
          fullName: "Qu·∫£n l√Ω 1",
          email: "tyler@gmail.com",
          phone: "0900000000",
          username: "quanly1",
          address: "273 An D∆∞∆°ng V∆∞∆°ng, Ph∆∞·ªùng Ch·ª£ Qu√°n, H·ªì Ch√≠ Minh",
          password: "abcd1234",
          status: "active",
          createdAt: new Date().toISOString(),
          isAdmin: true
        }
      ];
      localStorage.setItem("users", JSON.stringify(users));
      
      // T·ª± ƒë·ªông th√™m kh√°ch h√†ng m·∫∑c ƒë·ªãnh sau khi t·∫°o admin
      setTimeout(() => {
        autoAddDefaultCustomers();
        showNotification(`ƒê√£ t·ª± ƒë·ªông th√™m ${defaultCustomers.length} kh√°ch h√†ng m·∫∑c ƒë·ªãnh v√†o h·ªá th·ªëng!`);
      }, 100);
    } else {
      // N·∫øu ƒë√£ c√≥ d·ªØ li·ªáu, ki·ªÉm tra v√† th√™m kh√°ch h√†ng m·∫∑c ƒë·ªãnh n·∫øu c√≤n thi·∫øu
      autoAddDefaultCustomers();
    }

    // Kh·ªüi t·∫°o m·∫≠t kh·∫©u v√† tr·∫°ng th√°i cho c√°c user ch∆∞a c√≥
    users.forEach(user => {
      if (!user.password) {
        user.password = "123456";
      }
      if (user.status === undefined) {
        user.status = "active";
      }
    });
    saveUsers();

    // Hi·ªÉn th·ªã th√¥ng b√°o
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
      }`;
      notification.textContent = message;
      notification.classList.remove('hidden');
      
      setTimeout(() => {
        notification.classList.add('hidden');
      }, 3000);
    }

    function renderUsers(filter = "") {
      const table = document.getElementById("accountTable");
      table.innerHTML = "";

      const filteredUsers = users.filter(
        (u) =>
          (u.fullName && u.fullName.toLowerCase().includes(filter.toLowerCase())) ||
          (u.email && u.email.toLowerCase().includes(filter.toLowerCase())) ||
          (u.username && u.username.toLowerCase().includes(filter.toLowerCase()))
      );

      if (filteredUsers.length === 0) {
        table.innerHTML = `
            <tr>
              <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                <p>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o</p>
              </td>
            </tr>
          `;
        return;
      }

      filteredUsers.forEach((u, i) => {
        const originalIndex = users.findIndex(user => user.email === u.email);
        const statusText = u.status === "active" ? "üü¢ Ho·∫°t ƒë·ªông" : "üî¥ B·ªã kh√≥a";
        const statusClass = u.status === "active" ? "text-green-400" : "text-red-400";
        const roleText = u.isAdmin ? "üëë Qu·∫£n tr·ªã" : "üë§ Kh√°ch h√†ng";
        const roleClass = u.isAdmin ? "text-yellow-400" : "text-blue-400";

        const row = document.createElement("tr");
        row.className = "border-b border-gray-700 hover:bg-gray-750";
        row.innerHTML = `
            <td class="px-4 py-3">${u.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3">${u.email || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3">${u.username || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3">${u.phone || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3 ${roleClass} font-semibold">${roleText}</td>
            <td class="px-4 py-3 ${statusClass} font-semibold">${statusText}</td>
            <td class="px-4 py-3 space-x-2">
              <button onclick="editUser(${originalIndex})" class="bg-yellow-500 text-gray-900 px-3 py-1 rounded hover:bg-yellow-600 text-sm">S·ª≠a</button>
              <button onclick="toggleUserStatus(${originalIndex})" class="${u.status === "active" ? 'bg-red-500' : 'bg-green-500'} text-white px-3 py-1 rounded hover:opacity-90 text-sm">
                ${u.status === "active" ? 'Kh√≥a' : 'M·ªü kh√≥a'}
              </button>
              <button onclick="resetPassword(${originalIndex})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm">ƒê·∫∑t l·∫°i MK</button>
              ${!u.isAdmin ? `` : ''}
            </td>
          `;
        table.appendChild(row);
      });

      // C·∫≠p nh·∫≠t th·ªëng k√™
      updateStatistics();
    }

    function updateStatistics() {
      const stats = document.querySelectorAll('.grid div div:first-child');
      if (stats.length === 4) {
        stats[0].textContent = users.length;
        stats[1].textContent = users.filter(u => u.status === 'active').length;
        stats[2].textContent = users.filter(u => u.status === 'locked').length;
        stats[3].textContent = users.filter(u => u.isAdmin).length;
      }
    }

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
      renderUsers(document.getElementById("searchInput").value);
    }

    function toggleUserStatus(index) {
      if (index < 0 || index >= users.length) return;

      const user = users[index];
      // Kh√¥ng cho ph√©p kh√≥a t√†i kho·∫£n admin
      if (user.isAdmin) {
        showNotification("Kh√¥ng th·ªÉ kh√≥a t√†i kho·∫£n qu·∫£n tr·ªã vi√™n!", 'error');
        return;
      }

      const newStatus = user.status === "active" ? "locked" : "active";
      const action = newStatus === "locked" ? "kh√≥a" : "m·ªü kh√≥a";

      if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ${action} t√†i kho·∫£n "${user.fullName || user.email}"?`)) {
        users[index].status = newStatus;
        saveUsers();
        showNotification(`ƒê√£ ${action} t√†i kho·∫£n th√†nh c√¥ng!`);
      }
    }

    function resetPassword(index) {
      if (index < 0 || index >= users.length) return;

      const user = users[index];
      if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u cho "${user.fullName || user.email}" v·ªÅ m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh (123456)?`)) {
        users[index].password = "123456";
        saveUsers();
        showNotification("ƒê√£ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u th√†nh c√¥ng! M·∫≠t kh·∫©u m·ªõi: 123456");
      }
    }

    function deleteUser(index) {
      if (index < 0 || index >= users.length) return;

      const user = users[index];
      
      // Kh√¥ng cho ph√©p x√≥a t√†i kho·∫£n admin
      if (user.isAdmin) {
        showNotification("Kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n qu·∫£n tr·ªã vi√™n!", 'error');
        return;
      }

      if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n "${user.fullName || user.email}"?`)) {
        users.splice(index, 1);
        saveUsers();
        showNotification("ƒê√£ x√≥a t√†i kho·∫£n th√†nh c√¥ng!");
      }
    }

    function editUser(index) {
      if (index < 0 || index >= users.length) return;

      const u = users[index];
      document.getElementById("editIndex").value = index;
      document.getElementById("editName").value = u.fullName || '';
      document.getElementById("editEmail").value = u.email || '';
      document.getElementById("editPhone").value = u.phone || '';
      document.getElementById("editUsername").value = u.username || '';
      document.getElementById("editAddress").value = u.address || '';
      document.getElementById("editPassword").value = '';
      document.getElementById("editConfirmPassword").value = '';
      document.getElementById("editModal").classList.remove("hidden");
    }

    function closeEditModal() {
      document.getElementById("editModal").classList.add("hidden");
    }

    function openAddModal() {
      document.getElementById("addModal").classList.remove("hidden");
    }

    function closeAddModal() {
      document.getElementById("addModal").classList.add("hidden");
      document.getElementById("addForm").reset();
      document.getElementById("addPassword").value = "123456";
    }

    function generatePassword() {
      const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let password = "";
      for (let i = 0; i < 8; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      document.getElementById("addPassword").value = password;
    }

    function generateEditPassword() {
      const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let password = "";
      for (let i = 0; i < 8; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      document.getElementById("editPassword").value = password;
      document.getElementById("editConfirmPassword").value = password;
    }

    // X·ª≠ l√Ω form th√™m t√†i kho·∫£n
    document.getElementById("addForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const newUser = {
        fullName: document.getElementById("addName").value.trim(),
        email: document.getElementById("addEmail").value.trim(),
        phone: document.getElementById("addPhone").value.trim(),
        username: document.getElementById("addUsername").value.trim(),
        address: document.getElementById("addAddress").value.trim(),
        password: document.getElementById("addPassword").value,
        status: "active",
        createdAt: new Date().toISOString(),
        isAdmin: false
      };

      // Ki·ªÉm tra email tr√πng
      if (users.some(u => u.email === newUser.email)) {
        showNotification("Email ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng!", 'error');
        return;
      }

      // Ki·ªÉm tra username tr√πng
      if (users.some(u => u.username === newUser.username)) {
        showNotification("T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng!", 'error');
        return;
      }

      users.push(newUser);
      saveUsers();
      closeAddModal();
      showNotification("T·∫°o t√†i kho·∫£n th√†nh c√¥ng!\nM·∫≠t kh·∫©u: " + newUser.password);
    });

    // X·ª≠ l√Ω form s·ª≠a t√†i kho·∫£n
    document.getElementById("editForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const index = parseInt(document.getElementById("editIndex").value);
      const newPassword = document.getElementById("editPassword").value.trim();
      const confirmPassword = document.getElementById("editConfirmPassword").value.trim();

      if (newPassword && newPassword !== confirmPassword) {
        showNotification("M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp!", 'error');
        return;
      }

      // Ki·ªÉm tra email tr√πng (tr·ª´ ch√≠nh n√≥)
      const currentEmail = users[index].email;
      const newEmail = document.getElementById("editEmail").value.trim();
      if (newEmail !== currentEmail && users.some((u, i) => i !== index && u.email === newEmail)) {
        showNotification("Email ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng!", 'error');
        return;
      }

      // Ki·ªÉm tra username tr√πng (tr·ª´ ch√≠nh n√≥)
      const currentUsername = users[index].username;
      const newUsername = document.getElementById("editUsername").value.trim();
      if (newUsername !== currentUsername && users.some((u, i) => i !== index && u.username === newUsername)) {
        showNotification("T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng!", 'error');
        return;
      }

      // C·∫≠p nh·∫≠t th√¥ng tin
      users[index].fullName = document.getElementById("editName").value.trim();
      users[index].email = newEmail;
      users[index].phone = document.getElementById("editPhone").value.trim();
      users[index].username = newUsername;
      users[index].address = document.getElementById("editAddress").value.trim();

      if (newPassword) {
        users[index].password = newPassword;
      }

      saveUsers();
      closeEditModal();
      showNotification("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
    });

    document.getElementById("searchInput").addEventListener("input", function () {
      renderUsers(this.value);
    });

    // Kh·ªüi t·∫°o trang
    renderUsers();
  </script>
</body>

</html>