<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-cyan-400">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
      <button
        onclick="goBack()"
        class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded"
      >
        ‚Üê Quay l·∫°i
      </button>
    </div>

    <!-- Thanh c√¥ng c·ª• -->
    <div class="flex flex-col md:flex-row gap-4 mb-6">
      <input
        type="text"
        id="searchInput"
        placeholder="üîç T√¨m theo t√™n ho·∫∑c email..."
        class="bg-gray-700 text-white px-3 py-2 rounded flex-1"
      />
      <button
        onclick="openAddModal()"
        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold"
      >
        ‚ûï Th√™m t√†i kho·∫£n
      </button>
    </div>

    <!-- B·∫£ng ng∆∞·ªùi d√πng -->
    <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
      <table class="w-full table-auto">
        <thead class="bg-gray-700 text-cyan-300">
          <tr>
            <th class="px-4 py-3 text-left">H·ªç t√™n</th>
            <th class="px-4 py-3 text-left">Email</th>
            <th class="px-4 py-3 text-left">SƒêT</th>
            <th class="px-4 py-3 text-left">Tr·∫°ng th√°i</th>
            <th class="px-4 py-3 text-left">Thao t√°c</th>
          </tr>
        </thead>
        <tbody id="accountTable" class="text-gray-200"></tbody>
      </table>
    </div>

    <!-- Modal th√™m t√†i kho·∫£n -->
    <div
      id="addModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
        <h2 class="text-xl font-bold text-cyan-400 mb-4">‚ûï Th√™m t√†i kho·∫£n m·ªõi</h2>
        <form id="addForm" class="space-y-4">
          <div>
            <label class="block text-sm text-gray-300 mb-1">H·ªç t√™n *</label>
            <input
              type="text"
              id="addName"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="Nh·∫≠p h·ªç t√™n"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">Email *</label>
            <input
              type="email"
              id="addEmail"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="Nh·∫≠p email"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">S·ªë ƒëi·ªán tho·∫°i *</label>
            <input
              type="text"
              id="addPhone"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">T√™n ƒëƒÉng nh·∫≠p *</label>
            <input
              type="text"
              id="addUsername"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">ƒê·ªãa ch·ªâ</label>
            <textarea
              id="addAddress"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full resize-none"
              placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"
              rows="2"
            ></textarea>
          </div>
          <div class="border-t border-gray-700 pt-4">
            <h3 class="text-lg font-semibold text-cyan-300 mb-2">M·∫≠t kh·∫©u</h3>
            <div class="flex items-center space-x-2 mb-2">
              <input
                type="text"
                id="addPassword"
                class="bg-gray-700 text-white px-3 py-2 rounded flex-1"
                placeholder="M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh"
                value="123456"
                readonly
              />
              <button
                type="button"
                onclick="generatePassword()"
                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm"
              >
                T·∫°o m·ªõi
              </button>
            </div>
            <p class="text-xs text-gray-400">
              M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh: <span class="font-mono">123456</span>
            </p>
          </div>
          <div class="flex justify-end space-x-2 pt-4">
            <button
              type="button"
              onclick="closeAddModal()"
              class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500"
            >
              H·ªßy
            </button>
            <button
              type="submit"
              class="bg-green-500 text-white font-semibold px-4 py-2 rounded hover:bg-green-600"
            >
              T·∫°o t√†i kho·∫£n
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal s·ª≠a t√†i kho·∫£n -->
    <div
      id="editModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
        <h2 class="text-xl font-bold text-cyan-400 mb-4">üìù S·ª≠a t√†i kho·∫£n</h2>
        <form id="editForm" class="space-y-4">
          <input type="hidden" id="editIndex">
          <div>
            <label class="block text-sm text-gray-300 mb-1">H·ªç t√™n *</label>
            <input
              type="text"
              id="editName"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="H·ªç t√™n"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">Email *</label>
            <input
              type="email"
              id="editEmail"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="Email"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">S·ªë ƒëi·ªán tho·∫°i *</label>
            <input
              type="text"
              id="editPhone"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="SƒêT"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">T√™n ƒëƒÉng nh·∫≠p *</label>
            <input
              type="text"
              id="editUsername"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="T√™n ƒëƒÉng nh·∫≠p"
              required
            />
          </div>
          <div>
            <label class="block text-sm text-gray-300 mb-1">ƒê·ªãa ch·ªâ</label>
            <textarea
              id="editAddress"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full resize-none"
              placeholder="ƒê·ªãa ch·ªâ"
              rows="2"
            ></textarea>
          </div>
          <div class="border-t border-gray-700 pt-4">
            <h3 class="text-lg font-semibold text-cyan-300 mb-2">ƒê·ªïi m·∫≠t kh·∫©u</h3>
            <div class="flex items-center space-x-2 mb-2">
              <input
                type="text"
                id="editPassword"
                class="bg-gray-700 text-white px-3 py-2 rounded flex-1"
                placeholder="M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)"
              />
              <button
                type="button"
                onclick="generateEditPassword()"
                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm"
              >
                T·∫°o m·ªõi
              </button>
            </div>
            <input
              type="text"
              id="editConfirmPassword"
              class="bg-gray-700 text-white px-3 py-2 rounded w-full"
              placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi"
            />
          </div>
          <div class="flex justify-end space-x-2 pt-4">
            <button
              type="button"
              onclick="closeEditModal()"
              class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500"
            >
              H·ªßy
            </button>
            <button
              type="submit"
              class="bg-cyan-500 text-gray-900 font-semibold px-4 py-2 rounded hover:bg-cyan-600"
            >
              L∆∞u thay ƒë·ªïi
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>

     
      function goBack() {
        window.location.href = "daodienad.html";
      }

      // Ch·ªâ kh·ªüi t·∫°o v·ªõi t√†i kho·∫£n admin c∆° b·∫£n
      let users = JSON.parse(localStorage.getItem("users")) || [];
      
      // N·∫øu ch∆∞a c√≥ user n√†o, t·∫°o m·ªôt t√†i kho·∫£n admin m·∫∑c ƒë·ªãnh
      if (users.length === 0) {
        users = [
          {
            fullName: "Qu·∫£n tr·ªã vi√™n",
            email: "admin@mash.com",
            phone: "0900000000",
            username: "admin",
            address: "273 An D∆∞∆°ng V∆∞∆°ng, Ph∆∞·ªùng Ch·ª£ Qu√°n, H·ªì Ch√≠ Minh",
            password: "admin123",
            status: "active",
            createdAt: new Date().toISOString(),
            isAdmin: true
          }
        ];
        localStorage.setItem("users", JSON.stringify(users));
      }

      // Kh·ªüi t·∫°o m·∫≠t kh·∫©u v√† tr·∫°ng th√°i cho c√°c user ch∆∞a c√≥
      users.forEach(user => {
        if (!user.password) {
          user.password = "123456";
        }
        if (user.status === undefined) {
          user.status = "active";
        }
      });
      saveUsers();

      function renderUsers(filter = "") {
        const table = document.getElementById("accountTable");
        table.innerHTML = "";

        const filteredUsers = users.filter(
          (u) =>
            (u.fullName && u.fullName.toLowerCase().includes(filter.toLowerCase())) ||
            (u.email && u.email.toLowerCase().includes(filter.toLowerCase()))
        );

        if (filteredUsers.length === 0) {
          table.innerHTML = `
            <tr>
              <td colspan="5" class="px-4 py-8 text-center text-gray-400">
                <p>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o</p>
              </td>
            </tr>
          `;
          return;
        }

        filteredUsers.forEach((u, i) => {
          const originalIndex = users.findIndex(user => user.email === u.email);
          const statusText = u.status === "active" ? "üü¢ Ho·∫°t ƒë·ªông" : "üî¥ B·ªã kh√≥a";
          const statusClass = u.status === "active" ? "text-green-400" : "text-red-400";
          
          const row = document.createElement("tr");
          row.className = "border-b border-gray-700 hover:bg-gray-750";
          row.innerHTML = `
            <td class="px-4 py-3">${u.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3">${u.email || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3">${u.phone || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
            <td class="px-4 py-3 ${statusClass} font-semibold">${statusText}</td>
            <td class="px-4 py-3 space-x-2">
              <button onclick="editUser(${originalIndex})" class="bg-yellow-500 text-gray-900 px-3 py-1 rounded hover:bg-yellow-600 text-sm">S·ª≠a</button>
              <button onclick="toggleUserStatus(${originalIndex})" class="${u.status === "active" ? 'bg-red-500' : 'bg-green-500'} text-white px-3 py-1 rounded hover:opacity-90 text-sm">
                ${u.status === "active" ? 'Kh√≥a' : 'M·ªü kh√≥a'}
              </button>
              <button onclick="resetPassword(${originalIndex})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm">ƒê·∫∑t l·∫°i MK</button>
            </td>
          `;
          table.appendChild(row);
        });
      }

      function saveUsers() {
        localStorage.setItem("users", JSON.stringify(users));
        renderUsers(document.getElementById("searchInput").value);
      }

      function toggleUserStatus(index) {
        if (index < 0 || index >= users.length) return;
        
        const user = users[index];
        // Kh√¥ng cho ph√©p kh√≥a t√†i kho·∫£n admin
        if (user.isAdmin) {
          alert("Kh√¥ng th·ªÉ kh√≥a t√†i kho·∫£n qu·∫£n tr·ªã vi√™n!");
          return;
        }
        
        const newStatus = user.status === "active" ? "locked" : "active";
        const action = newStatus === "locked" ? "kh√≥a" : "m·ªü kh√≥a";
        
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ${action} t√†i kho·∫£n "${user.fullName || user.email}"?`)) {
          users[index].status = newStatus;
          saveUsers();
          alert(`ƒê√£ ${action} t√†i kho·∫£n th√†nh c√¥ng!`);
        }
      }

      function resetPassword(index) {
        if (index < 0 || index >= users.length) return;
        
        const user = users[index];
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u cho "${user.fullName || user.email}" v·ªÅ m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh (123456)?`)) {
          users[index].password = "123456";
          saveUsers();
          alert("ƒê√£ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u th√†nh c√¥ng! M·∫≠t kh·∫©u m·ªõi: 123456");
        }
      }

      function editUser(index) {
        if (index < 0 || index >= users.length) return;

        editIndex = index;
        const u = users[index];
        document.getElementById("editIndex").value = index;
        document.getElementById("editName").value = u.fullName || '';
        document.getElementById("editEmail").value = u.email || '';
        document.getElementById("editPhone").value = u.phone || '';
        document.getElementById("editUsername").value = u.username || '';
        document.getElementById("editAddress").value = u.address || '';
        document.getElementById("editPassword").value = '';
        document.getElementById("editConfirmPassword").value = '';
        document.getElementById("editModal").classList.remove("hidden");
      }

      function closeEditModal() {
        document.getElementById("editModal").classList.add("hidden");
      }

      function openAddModal() {
        document.getElementById("addModal").classList.remove("hidden");
      }

      function closeAddModal() {
        document.getElementById("addModal").classList.add("hidden");
        document.getElementById("addForm").reset();
        document.getElementById("addPassword").value = "123456";
      }

      function generatePassword() {
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let password = "";
        for (let i = 0; i < 8; i++) {
          password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        document.getElementById("addPassword").value = password;
      }

      function generateEditPassword() {
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let password = "";
        for (let i = 0; i < 8; i++) {
          password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        document.getElementById("editPassword").value = password;
        document.getElementById("editConfirmPassword").value = password;
      }

      // X·ª≠ l√Ω form th√™m t√†i kho·∫£n
      document.getElementById("addForm").addEventListener("submit", function (e) {
        e.preventDefault();
        
        const newUser = {
          fullName: document.getElementById("addName").value.trim(),
          email: document.getElementById("addEmail").value.trim(),
          phone: document.getElementById("addPhone").value.trim(),
          username: document.getElementById("addUsername").value.trim(),
          address: document.getElementById("addAddress").value.trim(),
          password: document.getElementById("addPassword").value,
          status: "active",
          createdAt: new Date().toISOString()
        };

        // Ki·ªÉm tra email tr√πng
        if (users.some(u => u.email === newUser.email)) {
          alert("Email ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng!");
          return;
        }

        users.push(newUser);
        saveUsers();
        closeAddModal();
        alert("T·∫°o t√†i kho·∫£n th√†nh c√¥ng!\nM·∫≠t kh·∫©u: " + newUser.password);
      });

      // X·ª≠ l√Ω form s·ª≠a t√†i kho·∫£n
      document.getElementById("editForm").addEventListener("submit", function (e) {
        e.preventDefault();
        
        const index = parseInt(document.getElementById("editIndex").value);
        const newPassword = document.getElementById("editPassword").value.trim();
        const confirmPassword = document.getElementById("editConfirmPassword").value.trim();
        
        if (newPassword && newPassword !== confirmPassword) {
          alert("M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp!");
          return;
        }
        
        // C·∫≠p nh·∫≠t th√¥ng tin
        users[index].fullName = document.getElementById("editName").value.trim();
        users[index].email = document.getElementById("editEmail").value.trim();
        users[index].phone = document.getElementById("editPhone").value.trim();
        users[index].username = document.getElementById("editUsername").value.trim();
        users[index].address = document.getElementById("editAddress").value.trim();
        
        if (newPassword) {
          users[index].password = newPassword;
        }
        
        saveUsers();
        closeEditModal();
        alert("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
      });

      document.getElementById("searchInput").addEventListener("input", function () {
        renderUsers(this.value);
      });

      // Kh·ªüi t·∫°o trang
      renderUsers();
    </script>
  </body>
</html>