<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tóm tắt đơn hàng - MASH Bakery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body class="font-sans text-gray-800 bg-white">
    <!-- HEADER -->
    <header class="flex justify-between items-center px-8 py-4 shadow-md bg-white sticky top-0 z-50">
        <h2 class="text-2xl font-bold text-[#8B0000]">
            <a href="./pages.html" class="hover:text-[#8B0000]">MASH</a>
        </h2>
        <nav class="hidden md:flex space-x-6 text-sm font-medium absolute left-1/2 transform -translate-x-1/2">
            <a href="./pages.html" class="hover:text-[#8B0000]">Trang chủ</a>
            <a href="sanpham.html" class="hover:text-[#8B0000]">Sản phẩm</a>
            <a href="gioithieu.html" class="hover:text-[#8B0000]">Giới thiệu</a>
            <a href="lienhe.html" class="hover:text-[#8B0000]">Liên hệ</a>
        </nav>
    </header>

    <!-- NỘI DUNG CHÍNH -->
    <div class="max-w-4xl mx-auto px-6 py-10">
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-[#8B0000] mb-2">Đặt hàng thành công!</h1>
            <p class="text-gray-600">Cảm ơn bạn đã đặt hàng tại MASH Bakery</p>
        </div>

        <div class="bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden">
            <div class="bg-[#8B0000] text-white p-6">
                <h2 class="text-xl font-semibold">Thông tin đơn hàng</h2>
                <div class="flex justify-between items-center mt-2">
                    <span>Mã đơn hàng: <strong id="orderId"></strong></span>
                    <span id="orderDate" class="text-sm"></span>
                </div>
            </div>

            <div class="p-6">
                <!-- Thông tin khách hàng -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h3 class="font-semibold text-[#8B0000] mb-2">Thông tin nhận hàng</h3>
                        <p id="customerName" class="font-medium"></p>
                        <p id="customerPhone" class="text-gray-600"></p>
                        <p id="customerAddress" class="text-gray-600"></p>
                        <p id="customerNote" class="text-gray-600 mt-2"></p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-[#8B0000] mb-2">Phương thức thanh toán</h3>
                        <p id="paymentMethod" class="font-medium"></p>
                        <p class="text-gray-600 mt-4">
                            <strong>Trạng thái:</strong> 
                            <span id="orderStatus" class="ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">Đang xử lý</span>
                        </p>
                    </div>
                </div>

                <!-- Chi tiết đơn hàng -->
                <div class="border-t pt-6">
                    <h3 class="font-semibold text-[#8B0000] mb-4">Chi tiết đơn hàng</h3>
                    <div id="orderItems" class="space-y-3 mb-4">
                        <!-- Sản phẩm sẽ được hiển thị ở đây -->
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Tạm tính:</span>
                            <span id="summarySubtotal" class="font-medium">0₫</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Phí vận chuyển:</span>
                            <span id="summaryShipping" class="font-medium">30,000₫</span>
                        </div>
                        <div class="flex justify-between text-lg font-semibold border-t pt-2">
                            <span>Tổng cộng:</span>
                            <span id="summaryTotal" class="text-[#8B0000]">0₫</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-center space-x-4 mt-8">
            <a href="./sanpham.html" 
               class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition font-semibold">
                Tiếp tục mua sắm
            </a>
            <a href="./LSmuahang.html" 
               class="bg-[#8B0000] text-white px-6 py-3 rounded-lg hover:bg-red-900 transition font-semibold">
                Xem lịch sử đơn hàng
            </a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Lấy orderId từ URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');
            
            if (!orderId) {
                alert("Không tìm thấy thông tin đơn hàng!");
                window.location.href = "./pages.html";
                return;
            }

            // Tìm đơn hàng trong localStorage
            const orders = JSON.parse(localStorage.getItem("orders")) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (!order) {
                alert("Không tìm thấy thông tin đơn hàng!");
                window.location.href = "./pages.html";
                return;
            }

            // Hiển thị thông tin đơn hàng
            displayOrderSummary(order);
        });

        function displayOrderSummary(order) {
            // Hiển thị thông tin cơ bản
            document.getElementById("orderId").textContent = order.id;
            document.getElementById("orderDate").textContent = formatDate(order.date);
            
            // Thông tin khách hàng
            document.getElementById("customerName").textContent = order.customer.name;
            document.getElementById("customerPhone").textContent = order.customer.phone;
            document.getElementById("customerAddress").textContent = order.customer.address;
            document.getElementById("customerNote").textContent = order.note || "Không có ghi chú";
            
            // Phương thức thanh toán
            document.getElementById("paymentMethod").textContent = getPaymentMethodName(order.payment);
            
            // Chi tiết sản phẩm
            const orderItemsContainer = document.getElementById("orderItems");
            orderItemsContainer.innerHTML = "";
            
            order.items.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const itemElement = document.createElement("div");
                itemElement.className = "flex justify-between items-center border-b pb-3";
                itemElement.innerHTML = `
                    <div class="flex-1">
                        <p class="font-medium">${item.name}</p>
                        <p class="text-sm text-gray-600">${item.price.toLocaleString("vi-VN")}₫ × ${item.quantity}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-[#8B0000]">${itemTotal.toLocaleString("vi-VN")}₫</p>
                    </div>
                `;
                orderItemsContainer.appendChild(itemElement);
            });

            // Tổng tiền
            document.getElementById("summarySubtotal").textContent = order.subtotal.toLocaleString("vi-VN") + "₫";
            document.getElementById("summaryShipping").textContent = order.shipping.toLocaleString("vi-VN") + "₫";
            document.getElementById("summaryTotal").textContent = order.total.toLocaleString("vi-VN") + "₫";
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getPaymentMethodName(value) {
            switch (value) {
                case 'cod': return 'Thanh toán khi nhận hàng (COD)';
                case 'momo': return 'Ví MoMo';
                case 'visa': return 'Thẻ Visa/Mastercard';
                default: return value;
            }
        }
    </script>
</body>
</html>