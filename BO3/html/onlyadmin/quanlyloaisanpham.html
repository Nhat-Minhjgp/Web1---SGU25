<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Loại Sản Phẩm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  </head>
  <body class="bg-gray-900 text-white font-sans min-h-screen">
    <!-- HEADER -->
    <header class="bg-gray-800 shadow-md px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-4">
          <button onclick="goBack()"
            class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-semibold px-4 py-2 rounded-lg transition flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Quay lại
          </button>
          <h1 class="text-2xl font-bold text-cyan-400">Quản lý Loại Sản Phẩm</h1>
        </div>
      </div>
    </header>

    <div class="flex h-[calc(100vh-80px)]">
      <!-- SIDEBAR -->
      <aside class="w-80 bg-gray-800 p-6 space-y-4 overflow-y-auto">
        <div class="pb-4 border-b border-gray-700">
          <h3 class="text-lg font-semibold text-cyan-400 mb-2">Thông tin tài khoản</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-400">Tên đăng nhập:</span>
              <span id="adminEmail">quanly1</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Đăng nhập lúc:</span>
              <span id="loginTime">10:30, 15/06/2023</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Trạng thái:</span>
              <span class="text-green-400">Đang hoạt động</span>
            </div>
          </div>
        </div>
        
        <nav class="space-y-2 pt-2">
          <button
            onclick="window.location.href='quanlykhachhang.html'"
            class="block w-full text-left px-4 py-2 rounded-lg hover:text-cyan-400 hover:bg-gray-700 transition"
          >
            <i class="fas fa-users mr-2"></i> Quản lý người dùng
          </button>
          <button
            onclick="window.location.href='quanlyloaisanpham.html'"
            class="block w-full text-left px-4 py-2 rounded-lg bg-cyan-600 text-white transition"
          >
            <i class="fas fa-tags mr-2"></i> Loại sản phẩm
          </button>
          <button
            onclick="window.location.href='danhmucsanpham.html'"
            class="block w-full text-left px-4 py-2 rounded-lg hover:text-cyan-400 hover:bg-gray-700 transition"
          >
            <i class="fas fa-boxes mr-2"></i> Danh mục sản phẩm
          </button>
          <button
            onclick="window.location.href='quanlyhangnhap.html'"
            class="block w-full text-left px-4 py-2 rounded-lg hover:text-cyan-400 hover:bg-gray-700 transition"
          >
            <i class="fas fa-arrow-down mr-2"></i> Quản lý hàng nhập
          </button>
          <button
            onclick="window.location.href='quanlydondathang.html'"
            class="block w-full text-left px-4 py-2 rounded-lg hover:text-cyan-400 hover:bg-gray-700 transition"
          >
            <i class="fas fa-receipt mr-2"></i> Quản lý đơn đặt hàng
          </button>
          <button
            onclick="window.location.href='giaban.html'"
            class="block w-full text-left px-4 py-2 rounded-lg hover:text-cyan-400 hover:bg-gray-700 transition"
          >
            <i class="fas fa-tag mr-2"></i> Giá bán
          </button>
          <button
            onclick="window.location.href='hangtonkho.html'"
            class="block w-full text-left px-4 py-2 rounded-lg hover:text-cyan-400 hover:bg-gray-700 transition"
          >
            <i class="fas fa-warehouse mr-2"></i> Tồn kho
          </button>
        </nav>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="flex-1 p-6 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
          <!-- Form thêm/sửa -->
          <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-8 border-l-4 border-blue-500">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
              <i class="fas fa-plus-circle"></i>
              <span>Thêm / Sửa loại sản phẩm</span>
            </h2>
            <form id="categoryForm" class="space-y-4">
              <input type="hidden" id="categoryId" value="">
              <div>
                <label class="block mb-1 text-gray-300">Tên loại sản phẩm</label>
                <input
                  type="text"
                  id="categoryName"
                  class="w-full p-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
                  placeholder="Nhập tên loại sản phẩm"
                  required
                />
              </div>
              <div class="flex gap-4">
                <button
                  type="submit"
                  id="addBtn"
                  class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white transition-colors duration-200 flex items-center gap-2"
                >
                  <i class="fas fa-plus"></i>
                  <span>Thêm</span>
                </button>
                <button
                  type="button"
                  id="updateBtn"
                  class="bg-yellow-500 hover:bg-yellow-600 px-4 py-2 rounded text-white transition-colors duration-200 flex items-center gap-2 hidden"
                >
                  <i class="fas fa-edit"></i>
                  <span>Cập nhật</span>
                </button>
                <button
                  type="button"
                  id="cancelBtn"
                  class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-white transition-colors duration-200 flex items-center gap-2 hidden"
                >
                  <i class="fas fa-times"></i>
                  <span>Hủy</span>
                </button>
              </div>
            </form>
          </div>

          <!-- Tìm kiếm -->
          <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-8 border-l-4 border-green-500">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
              <i class="fas fa-search"></i>
              <span>Tìm loại sản phẩm</span>
            </h2>
            <input
              type="text"
              id="searchInput"
              class="w-full p-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200"
              placeholder="Nhập từ khóa tìm kiếm..."
            />
          </div>

          <!-- Danh sách loại sản phẩm -->
          <div class="bg-gray-800 p-6 rounded-lg shadow-md border-l-4 border-purple-500">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
              <i class="fas fa-list"></i>
              <span>Danh sách loại sản phẩm</span>
            </h2>
            <div class="overflow-x-auto">
              <table class="w-full table-auto text-left">
                <thead>
                  <tr class="text-gray-400 border-b border-gray-600">
                    <th class="pb-2">ID</th>
                    <th class="pb-2">Tên loại</th>
                    <th class="pb-2 text-right">Hành động</th>
                  </tr>
                </thead>
                <tbody id="categoryTableBody">
                  <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                </tbody>
              </table>
            </div>
            <div id="noDataMessage" class="text-center py-4 text-gray-400 hidden">
              <i class="fas fa-inbox text-4xl mb-2"></i>
              <p>Không có dữ liệu loại sản phẩm</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modal xác nhận xóa -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
      <div class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
        <h3 class="text-xl font-semibold mb-4">Xác nhận xóa</h3>
        <p class="mb-6">Bạn có chắc chắn muốn xóa loại sản phẩm "<span id="deleteCategoryName"></span>"?</p>
        <div class="flex justify-end gap-4">
          <button id="cancelDelete" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-white transition-colors duration-200">
            Hủy
          </button>
          <button id="confirmDelete" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-white transition-colors duration-200">
            Xóa
          </button>
        </div>
      </div>
    </div>

    <script>
      // Dữ liệu mẫu
      let categories = [
        { id: 1, name: "Nhân ngọt" },
        { id: 2, name: "Nhân mặn" },
        { id: 3, name: "Đặc biệt" }
      ];

      // Biến để theo dõi chế độ chỉnh sửa
      let isEditing = false;
      let currentEditId = null;

      // DOM Elements
      const categoryForm = document.getElementById('categoryForm');
      const categoryNameInput = document.getElementById('categoryName');
      const categoryIdInput = document.getElementById('categoryId');
      const addBtn = document.getElementById('addBtn');
      const updateBtn = document.getElementById('updateBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const searchInput = document.getElementById('searchInput');
      const categoryTableBody = document.getElementById('categoryTableBody');
      const noDataMessage = document.getElementById('noDataMessage');
      const deleteModal = document.getElementById('deleteModal');
      const deleteCategoryName = document.getElementById('deleteCategoryName');
      const cancelDeleteBtn = document.getElementById('cancelDelete');
      const confirmDeleteBtn = document.getElementById('confirmDelete');

      // Biến để theo dõi xóa
      let categoryToDelete = null;

      function goBack() {
        window.location.href = "daodienad.html";
      }

      // Hiển thị danh sách loại sản phẩm
      function renderCategories(categoriesToRender = categories) {
        categoryTableBody.innerHTML = '';
        
        if (categoriesToRender.length === 0) {
          noDataMessage.classList.remove('hidden');
          return;
        }
        
        noDataMessage.classList.add('hidden');
        
        categoriesToRender.forEach(category => {
          const row = document.createElement('tr');
          row.className = 'border-b border-gray-700 hover:bg-gray-750 transition-colors duration-200';
          row.innerHTML = `
            <td class="py-3">${category.id}</td>
            <td class="py-3">${category.name}</td>
            <td class="py-3 text-right">
              <button
                class="edit-btn bg-yellow-500 hover:bg-yellow-600 px-3 py-1 rounded text-white text-sm transition-colors duration-200 mr-2"
                data-id="${category.id}"
              >
                <i class="fas fa-edit mr-1"></i>Sửa
              </button>
              <button
                class="delete-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white text-sm transition-colors duration-200"
                data-id="${category.id}"
                data-name="${category.name}"
              >
                <i class="fas fa-trash mr-1"></i>Xóa
              </button>
            </td>
          `;
          categoryTableBody.appendChild(row);
        });
        
        // Thêm sự kiện cho các nút sửa và xóa
        document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', handleEdit);
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', handleDelete);
        });
      }

      // Xử lý thêm/sửa loại sản phẩm
      categoryForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = categoryNameInput.value.trim();
        if (!name) {
          alert('Vui lòng nhập tên loại sản phẩm');
          return;
        }
        
        if (isEditing) {
          // Cập nhật loại sản phẩm
          const index = categories.findIndex(cat => cat.id === currentEditId);
          if (index !== -1) {
            categories[index].name = name;
          }
          resetForm();
        } else {
          // Thêm loại sản phẩm mới
          const newId = categories.length > 0 ? Math.max(...categories.map(cat => cat.id)) + 1 : 1;
          categories.push({
            id: newId,
            name: name
          });
          categoryNameInput.value = '';
        }
        
        renderCategories();
      });

      // Xử lý sửa loại sản phẩm
      function handleEdit(e) {
        const id = parseInt(e.currentTarget.getAttribute('data-id'));
        const category = categories.find(cat => cat.id === id);
        
        if (category) {
          isEditing = true;
          currentEditId = id;
          categoryNameInput.value = category.name;
          categoryIdInput.value = category.id;
          
          // Hiển thị nút cập nhật và hủy, ẩn nút thêm
          addBtn.classList.add('hidden');
          updateBtn.classList.remove('hidden');
          cancelBtn.classList.remove('hidden');
          
          // Focus vào input
          categoryNameInput.focus();
        }
      }

      // Xử lý cập nhật loại sản phẩm
      updateBtn.addEventListener('click', function() {
        const name = categoryNameInput.value.trim();
        if (!name) {
          alert('Vui lòng nhập tên loại sản phẩm');
          return;
        }
        
        const index = categories.findIndex(cat => cat.id === currentEditId);
        if (index !== -1) {
          categories[index].name = name;
        }
        
        resetForm();
        renderCategories();
      });

      // Xử lý hủy chỉnh sửa
      cancelBtn.addEventListener('click', resetForm);

      // Reset form về trạng thái ban đầu
      function resetForm() {
        isEditing = false;
        currentEditId = null;
        categoryNameInput.value = '';
        categoryIdInput.value = '';
        
        // Hiển thị nút thêm, ẩn nút cập nhật và hủy
        addBtn.classList.remove('hidden');
        updateBtn.classList.add('hidden');
        cancelBtn.classList.add('hidden');
      }

      // Xử lý xóa loại sản phẩm
      function handleDelete(e) {
        const id = parseInt(e.currentTarget.getAttribute('data-id'));
        const name = e.currentTarget.getAttribute('data-name');
        
        categoryToDelete = id;
        deleteCategoryName.textContent = name;
        deleteModal.classList.remove('hidden');
      }

      // Xác nhận xóa
      confirmDeleteBtn.addEventListener('click', function() {
        if (categoryToDelete) {
          categories = categories.filter(cat => cat.id !== categoryToDelete);
          renderCategories();
          deleteModal.classList.add('hidden');
          categoryToDelete = null;
        }
      });

      // Hủy xóa
      cancelDeleteBtn.addEventListener('click', function() {
        deleteModal.classList.add('hidden');
        categoryToDelete = null;
      });

      // Tìm kiếm loại sản phẩm
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        
        if (searchTerm === '') {
          renderCategories();
          return;
        }
        
        const filteredCategories = categories.filter(category => 
          category.name.toLowerCase().includes(searchTerm)
        );
        
        renderCategories(filteredCategories);
      });

      // Khởi tạo
      document.addEventListener('DOMContentLoaded', function() {
        renderCategories();
      });
    </script>
  </body>
</html>